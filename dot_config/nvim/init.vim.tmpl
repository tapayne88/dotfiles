" vi: filetype=vim
let s:vim_path = expand('~/.vim')
let s:vimrc = expand('~/.vimrc')
if has("nvim")
  let s:vim_path = expand('~/.config/nvim')
  let s:vimrc = expand('~/.config/nvim/init.vim')
endif

let s:plug_exec_path = s:vim_path . '/autoload/plug.vim'
if empty(glob(s:plug_exec_path))
  silent exec '!curl -fLo ' . s:plug_exec_path . ' --create-dirs ' .
    \ 'https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'
  autocmd VimEnter * PlugInstall --sync | source $MYVIMRC
endif

"" ==================== Pre Plug ====================
" Only load vim-test if these commands are used
let vimTestCommands = ['TestNearest', 'TestFile', 'TestSuite', 'TestLast', 'TestVisit']

"" ==================== Vim Plug ====================
call plug#begin(s:vim_path.'/plugged')

" Core Bundles
Plug 'lervag/file-line'                     " Handle filenames with line numbers i.e. :20
Plug 'tpope/vim-fugitive'                   " Git integration ':Gstatus' etc.
Plug 'tpope/vim-characterize'               " Adds 'ga' command to show character code
Plug 'tpope/vim-commentary'                 " Adds 'gc' & 'gcc' commands for commenting lines
Plug 'tpope/vim-eunuch'                     " Adds unix commands like ':Move' etc.
Plug 'tpope/vim-surround'                   " Adds 'cs' command to change surround e.g. cs'<p> - would change 'this' => <p>this</p>
Plug 'tpope/vim-dispatch', {
  \ 'on': 'Dispatch' }                      " Async vim compiler plugins (used to run mocha test below)
Plug 'jaawerth/nrun.vim'                    " Put locally installed npm module .bin at front of path
Plug 'tpope/vim-sleuth'                     " Detect indentation
Plug 'christoomey/vim-tmux-navigator'       " Seemless vim <-> tmux navigation
Plug 'ryanoasis/vim-devicons'               " Filetype icons
Plug 'wincent/scalpel'                      " Easier find & replace
Plug 'simeji/winresizer'                    " Simple plugin to easily resize windows
Plug 'janko-m/vim-test', {
  \ 'on': vimTestCommands }                 " easy testing
Plug 'tweekmonster/startuptime.vim', {
  \ 'on': 'StartupTime' }                   " easier vim startup time profiling
Plug 'iamcco/markdown-preview.nvim', {
  \ 'do': ':call mkdp#util#install()',
  \ 'for': 'markdown',
  \ 'on': 'MarkdownPreview' }               " Markdown previewing commands
Plug 'rhysd/git-messenger.vim', {
  \ 'on': 'GitMessenger' }                  " Git blame for line with commit message

{{- if .neovim_nightly }}
Plug 'ChristianChiarulli/nvcode-color-schemes.vim'  " treesitter colorscheme
Plug 'nvim-treesitter/nvim-treesitter', {
  \ 'do': ':TSUpdate' }                     " better syntax highlighting
Plug 'nvim-treesitter/playground'           " playground for illustrating the AST treesitter builds
Plug 'nvim-lua/popup.nvim'                  " dependency of telescope
Plug 'nvim-lua/plenary.nvim'                " dependency of telescope
Plug 'nvim-telescope/telescope.nvim'        " whizzy command-p launcher
Plug 'kyazdani42/nvim-web-devicons'         " devicons for lua plugins
Plug 'lewis6991/gitsigns.nvim'              " + & - in column for changed lines

" Syntax not supported by treesitter
Plug 'plasticboy/vim-markdown'
{{- else }}
Plug 'arcticicestudio/nord-vim'
Plug 'liuchengxu/vim-clap', {
  \ 'do': { -> clap#installer#force_download() } } " whizzy command-p launcher
Plug 'vn-ki/coc-clap'                       " Integrate coc.nvim with vim-clap
Plug 'mhinz/vim-signify'                    " + & - in column for changed lines
Plug 'sheerun/vim-polyglot'                 " Syntax highlighting
{{- end }}

{{- if .neovim_nightly_native_lsp }}
Plug 'neovim/nvim-lspconfig'                " native neovim LSP support
Plug 'kabouzeid/nvim-lspinstall'            " install LSP servers
Plug 'nvim-lua/lsp-status.nvim'             " LSP status display
Plug 'glepnir/lspsaga.nvim'                 " Better LSP diagnostics display
Plug 'nvim-lua/completion-nvim'             " Auto completion plugin for nvim
Plug 'steelsojka/completion-buffers'
Plug 'nvim-treesitter/completion-treesitter'
Plug 'hoob3rt/lualine.nvim'                 " statusline in lua
{{- else }}
Plug 'itchyny/lightline.vim'                " Status line plugin
Plug 'neoclide/coc.nvim', {
  \ 'branch': 'release' }                   " LSPish integration
{{- end }}

call plug#end()

luafile ~/.config/nvim/lua/tap/settings.lua
luafile ~/.config/nvim/lua/tap/colours.lua
luafile ~/.config/nvim/lua/tap/auto.lua
luafile ~/.config/nvim/lua/tap/keymap.lua

{{- if .neovim_nightly }}
" Load all lua files
lua require('tap')
{{- end }}

if filereadable(expand('~/.vimrc.local'))
  source ~/.vimrc.local
endif
