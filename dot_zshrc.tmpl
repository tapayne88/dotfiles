# vi: filetype=zsh
export ZSH_HOME=~/.config/zsh

export VISUAL=nvim
export EDITOR=nvim

# executable search path (last to first order)
PATHS=(
  /usr/local/bin
  /usr/local/sbin
  /home/linuxbrew/.linuxbrew/bin
  /home/linuxbrew/.linuxbrew/sbin
  $HOME/.local/bin
  $HOME/Library/Python/3.7/bin
)
for p in $PATHS; do
  if (test -d $p); then
    export PATH="$p:$PATH"
  fi
done

# Setup DEFAULT_USER for the theme
USER=`whoami`
if [ $USER = '{{ .chezmoi.username }}' ]; then
    DEFAULT_USER=$USER
fi

# Disables scroll lock shortcut (Ctrl+s)
stty -ixon
KEYTIMEOUT=1

# fzf defaults
export FZF_DEFAULT_COMMAND="ag --nocolor -g ''"
export FZF_CTRL_T_COMMAND="ag --nocolor -g ''"
export FZF_TMUX=1
export FZF_TMUX_HEIGHT="40%"
export FZF_LEGACY_KEYBINDINGS=0

export FZF_DEFAULT_OPTS="\
  --preview 'bat --style=numbers --color=always {} | head -500'
  --layout reverse \
  --color bg+:0,hl:0,hl+:4,fg:7,fg+:15,header:4,info:4,marker:4,pointer:4,prompt:4,spinner:4 \
"

# Prevent FFP opening multiple splits
export FPP_DISABLE_SPLIT=1

# tmuxp thing
export DISABLE_AUTO_TITLE='true'

zstyle :omz:plugins:ssh-agent agent-forwarding on
zstyle :omz:plugins:ssh-agent identities ""
zstyle :omz:plugins:ssh-agent lifetime 10m

export ZSH_TMUX_AUTOSTART="true"
export ZSH_TMUX_AUTOQUIT="false"
export ZSH_TMUX_AUTOCONNECT="false"

if [[ -f "$HOME/.dircolors" ]] && (( $+commands[gdircolors] )); then
  eval `gdircolors $HOME/.dircolors`
fi

source ~/.zplug/init.zsh

zplug "zsh-users/zsh-autosuggestions"
zplug "zsh-users/zsh-syntax-highlighting"
zplug "zsh-users/zsh-completions",          use:src
zplug "lib/theme-and-appearance",           from:oh-my-zsh
zplug "lib/completion",                     from:oh-my-zsh
zplug "lib/key-bindings",                   from:oh-my-zsh
zplug "plugins/common-aliases",             from:oh-my-zsh
zplug "plugins/fzf",                        from:oh-my-zsh
zplug "plugins/z",                          from:oh-my-zsh
zplug "plugins/tmux",                       from:oh-my-zsh
zplug "plugins/ssh-agent",                  from:oh-my-zsh
zplug "$ZSH_HOME/themes",                   from:local,     as:theme
zplug "$ZSH_HOME/lib",                      from:local
zplug "$ZSH_HOME/plugins",                  from:local
zplug "$ZSH_HOME/completions",              from:local

if ! zplug check --verbose; then
  printf "Install? [y/N]: "
  if read -q; then
    echo; zplug install
  fi
fi

zplug load

sourceOPSession

# Need to run this after oh-my-zsh lib/completion as it resets it
# for the benefit of macOS
zstyle ':completion:*' list-colors "${(@s.:.)LS_COLORS}"

LOCAL_RC=~/.zshrc.local
if [ -e $LOCAL_RC ]; then
  source $LOCAL_RC
fi
